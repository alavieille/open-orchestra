{# allow to load js scripts, to load parameters (direct or rendered) and create the dialog box #}
{% block generic_behavior %}
    {% if form.vars.js is defined and form.vars.js|length > 0 %}
        <script>
            var parameter = {};
        {% if form.vars.js.parameter is defined and form.vars.js.parameter|length > 0 %}
            {% for key, parameter in form.vars.js.parameter %}
                parameter.{{ key }} = '{{ parameter}}';
            {% endfor %}
        {% endif %}
        {% if form.vars.js.render is defined and form.vars.js.render|length > 0 %}
            {% for key, parameters in form.vars.js.render %}
                parameter.{{ key }} = {% include parameters.twig with parameters.parameter only %};
            {% endfor %}
        {% endif %}
        </script>
        <script src="{{ asset('bundles/phporchestracms/js/' ~ form.vars.js.script) }}"></script>
        <script>
            init(parameter);
        </script>
    {% endif %}
    {% if showDialog %}
    <script>
        $( "#dialog-{{ form.vars.name }}" ).dialog($.extend(dialog_parameter, {"addArray" : {{ form.vars.objects|json_encode|raw }}}));
    </script>
    {% endif %}
{% endblock %}


{# factorization of archestra_areas and archestra_blocks behavior #}
{% block orchestra_widget %}
    {% if showDialog %}
    <div id="dialog-{{ form.vars.name }}" style="display:none;" title="{{ form.vars.name }}">
        {% if form.vars.dialogPath != '' %}
            {% include form.vars.dialogPath %}
        {% endif %}
    </div>
    {% else %}
        <div id="dialog-{{ form.vars.name }}" title="{{ form.vars.name }}">
            {% if form.vars.dialogPath != '' %}
                {% include form.vars.dialogPath %}
            {% endif %}
        </div>
    {% endif %}
    {{ block('generic_behavior') }}
    {{ form_widget(form) }}

{% endblock %}


{% block orchestra_areas_widget %}
    {% set showDialog = form.parent.vars.showDialog %}
    {{ block('orchestra_widget') }}
{% endblock %}

{% block orchestra_blocks_widget %}
    {% set showDialog = form.parent.vars.showDialog %}
    {{ block('orchestra_widget') }}
{% endblock %}

{% extends "form_div_layout.html.twig" %}

{% block form_row %}
{% spaceless %}
    <section>
    {% if block_prefixes[1] == 'checkbox' %}
        <label class="checkbox">
            {{ form_widget(form) }}
            <i></i>{{ form_label(form, null, {'label_attr': {'class': 'label'}}) }}</label>
    {% else %}
        {{ form_label(form, null, {'label_attr': {'class': 'label'}}) }}
        <label class="{{ block_prefixes[1]|lexicon_translator }} {% if multiple is defined and multiple %} select-multiple{% endif %}">
            {{ form_widget(form) }}{% if multiple is not defined or not multiple %}<i></i>{% endif %}
        </label>
    {% endif %}
        <div class="note">
            {{ form_errors(form) }}
        </div>
    </section>
{% endspaceless %}
{% endblock form_row %}


{% block form %}
{% spaceless %}
    {% if form.vars.showDialog is defined  and form.vars.showDialog %}
        <div id="dialog-{{ form.vars.name }}" style="display:none;" title="{{ form.vars.name }}">
            {{ form_start(form, {'attr': {'class': 'smart-form'}}) }}
                <fieldset>
                {{ form_widget(form) }}
                </fieldset>
            {{ form_end(form) }}
        </div>
        <div id="{{ form.vars.name }}-model" class="template-model"></div>
        {{ block('generic_behavior') }}
        <script>
            $(function(){
                $('#{{ form.vars.name }}-model').parseTemplate({"init" : true});
            });
        </script>
    {% else %}
        {{ form_start(form, {'attr': {'class': 'smart-form'}}) }}
            <fieldset>
            {{ form_widget(form) }}
            </fieldset>
        {{ form_end(form) }}
    {% endif %}
{% endspaceless %}
{% endblock form %}