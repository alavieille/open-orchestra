{##
 # This file is part of the PHPOrchestra\CMSBundle.
 #
 # @author NoÃ«l Gilain <noel.gilain@businessdecision.com>
 ##}

<fieldset id="{{ area.areaId }}">
    <legend>{{ area.areaId }}</legend>
{% for subArea in area.subAreas %}
    {% include "PHPOrchestraCMSBundle:Node:area.html.twig" with {"area" : subArea, "blocks" : blocks, "relatedNodes" : relatedNodes} only %}
{% endfor %}
{% for blockReference in area.blocks %}
    {% set block = false %}
    {% if blockReference.nodeId == 0 %}
        {% if blocks.iterator[blockReference.blockId] is defined %}
            {% set block = blocks.iterator[blockReference.blockId] %}
        {% endif %}
    {% else %}
        {% if relatedNodes[blockReference.nodeId].iterator[blockReference.blockId] is defined %}
            {% set block = relatedNodes[blockReference.nodeId].iterator[blockReference.blockId] %}
        {% endif %}
    {% endif %}
    BlockId : {{ blockReference.blockId }} / NodeId : {{ blockReference.nodeId }} <br/>
    {% if block %}
        {{ render(controller(block.component, {'block': block.attributes})) }}
    {% endif %}
{% endfor %}
</fieldset>
